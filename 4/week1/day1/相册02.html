<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="css/xiangce02.css" rel="stylesheet">
    <script src="jQuery_lib/jquery-3.1.0.js"></script>

    <script>
    	//有闪屏bug
    	
        $(function(){
            //尽量少点用$找DOM元素
            var $ul=$("#gallery")
            var $ul_width=$ul.width()
            var $ul_height=$ul.height()
            var ROW=4;
            var COL=5;

            //初设-----------------------------------
            for(var i=0;i<ROW;i++){
                for(var j=0;j<COL;j++){
                    $("<li><div class='img'></div></li>").find("div")
                            .width($ul.width()/COL)
                            .height($ul.height()/ROW)
                            .css('background-image',"url(images/0.jpg)")
                            .css("background-position",j*100/(COL-1)+"% "+i*100/(ROW-1)+"%")
                            .end()
                            .css("left",$ul_width/COL*j)
                            .css("top",$ul_height/ROW*i)
                            //给li发牌照
                            .attr("index",i*COL+j)
                            .appendTo($ul)
                }
            }
            $("#sliceAni").click(sliceAni);
            $("#backAni").click(backAni);

    //animate和transform不兼容

            function sliceAni(){
            	setTimeout(function(){
	            	$("#gallery li div").each(function(index) {
	                     $(this).css("transition","transform 2s ease-in 2s")
	                            .css({"transform":"scale(0.95) "})
	                            .css('background-image', "url(images/" + index + ".jpg)")
	                            .css("background-size", "cover")
	                });
	                $("#gallery li").each(function(index){
	                    var r=Math.floor(index/COL);  //行数
	                    var c=index%COL;               //列数
	                    var tx=Math.ceil(c-COL/2)*30;
	                    var ty=Math.ceil(r-ROW/2)*20;
	                    var z=Math.random()*40-20
	                    $(this).css({"transform":"rotate("+z+"deg) translate("+tx+"%,"+ty+"%)"})
	                });	
            	},0200)
                
            };

            function backAni(){
                $("#gallery li").css({"transform":"rotate(0deg) translate(0%,0%)"})

                $("#gallery li div")
                        .css({"transform":"scale(1) "})
                            //把延迟去掉   li和div动画就同步进行了
                        .css("transition","transform 2s ease-in")
            }
            var a=false;
            $("#gallery li div").each(function(index){
                $(this).click(function(){
                    if(a){
                        $("#gallery li div")
                        //把行内background-size:cover冲掉
                                .css("background-size", "auto")
                                //background-postion在预设中已经写入行内
                                .css('background-image', "url(images/" + index + ".jpg)")
                                //把延迟去掉
                                .css("transition","transform 2s ease-in")
                        backAni();
                        a=false;
                    }
                    else{
                        sliceAni();
                        a=true
                    }
                })
            })
        })



    </script>
</head>
<body>

<input type="button" id="sliceAni" value="拆分动画" style="width: 80px;height: 30px">
<input type="button" id="backAni" value="还原动画" style="width: 80px;height: 30px">
<input type="button" id="toggle" value="toggle" style="width: 50px;height: 30px">
<ul id="gallery" class="mid" >
</ul>
</body>
</html>