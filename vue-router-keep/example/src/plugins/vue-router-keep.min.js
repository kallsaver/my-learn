/*!
 * vue-router-keep.js v0.0.1
 * (c) 2019-2019 kallsave
 * Released under the MIT License.
 */
/*!
 * vue-router-keep.js v0.0.1
 * (c) 2019-2019 kallsave
 * Released under the MIT License.
 */
var e,t;e=this,t=function(){"use strict";var e={max:1/0,actionKey:"action"};function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var r,o,a,c,s=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;t(this,e),this.max=n,this.init()}return i(e,[{key:"init",value:function(){this.list=[]}},{key:"_add",value:function(e){var t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1),this.list.unshift(e),this.list.length>this.max&&this.list.pop()}},{key:"add",value:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];this._add(t)}}},{key:"reduce",value:function(){return!!this.list.length&&this.list.shift()}},{key:"replace",value:function(e){if(!this.reduce())return!1;this._add(e)}},{key:"removeFrom",value:function(e){var t=this.list.indexOf(e);return-1!==t&&this.list.splice(t)}},{key:"remove",value:function(e){var t=this.list.indexOf(e);return-1!==t&&this.list.splice(t,1)}},{key:"removeByIndex",value:function(e){if(this.list[e])return this.list.splice(e,1)}},{key:"removeAll",value:function(){return this.list.splice(0)}},{key:"removeExclude",value:function(){for(var e=0;e<this.list.length;e++){var t=this.list[e];-1===Array.prototype.indexOf.call(arguments,t)&&(this.list.splice(e,1),e--)}}},{key:"backTo",value:function(e){var t=this.list.indexOf(e);return-1!==t&&this.list.splice(0,t)}},{key:"backToByIndex",value:function(e){return e>this.list.length-1?this.list.splice(0):this.list.splice(0,e)}},{key:"getHeader",value:function(){return this.list[0]}},{key:"getByIndex",value:function(e){return this.list[e]}},{key:"getFooter",value:function(){return this.list[this.list.length-1]}},{key:"getSize",value:function(){return this.list.length}},{key:"getStore",value:function(){return this.list}},{key:"getMax",value:function(){return this.max}},{key:"has",value:function(e){return-1!==this.list.indexOf(e)}},{key:"updateSize",value:function(e){this.max=e}},{key:"checkFull",value:function(){return this.max<=this.list.length}}]),e}(),u=new s(e.max),l=[];r=e,o="max",a=e.max,c=function(e){u.updateSize(e)},Object.defineProperty(r,o,{enumerable:!0,configurable:!0,get:function(){return a},set:function(e){e!==a&&(a=e,"function"==typeof c&&c(e))}});var h={remove:function(e){for(var t=0;t<l.length;t++){var n=l[t],i=(n.stack,n.cache);i[e]&&(i[e].componentInstance.$destroy(),i[e]=null,u.remove(e))}},removeAll:function(){for(var e=0;e<l.length;e++){var t=l[e],n=(t.stack,t.cache);for(var i in n)n[i].componentInstance.$destroy(),n[i]=null}u.removeAll()},getStore:function(){return{cache:l,stack:u.getStore()}}},f=function(){function e(){t(this,e),this.map={}}return i(e,[{key:"on",value:function(e,t){this.map[e]?this.map[e].push(t):this.map[e]=[t]}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.map[e]&&this.map[e].forEach((function(e){e.apply(void 0,n)}))}}]),e}(),v=new s,d=new f;function m(e){return null!=e}window.addEventListener("hashchange",(function(){v.getByIndex(1)===window.location.href?d.emit("back"):d.emit("forward")}));var y={name:"router-keep",abstract:!0,created:function(){this.cache=Object.create(null),l.push({cache:this.cache})},render:function(e){var t=this.$slots.default,n=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];if(m(n)&&(m(n.componentOptions)||(i=n).isComment&&i.asyncFactory))return n}var i}(t);if(console.log(u.getMax()),n){var i=this.$route.name;if(this.cache[i])n.componentInstance=this.cache[i].componentInstance;else if(u.checkFull()){console.log("full");var r=u.getFooter();h.remove(r),this.cache[i]=n}else console.log("node"),this.cache[i]=n;u.add(i),n.data.keepAlive=!0}return n||t&&t[0]},mounted:function(){this.historyStateBackHandler()},methods:{historyStateBackHandler:function(){var e=this;d.on("back",(function(){e.remove(u.getByIndex(0))}))},remove:function(e){this.removeCacheItem(e),this.removeStackItem(e)},removeCacheItem:function(e){this.cache[e]&&(this.cache[e].componentInstance.$destroy(),this.cache[e]=null)},removeStackItem:function(e){u.remove(e)}},beforeDestroy:function(){for(var e in this.cache)this.remove(e);for(var t,n=0;n<l.length;n++)if(this.cache===l[n]){t=n;break}l.splice(t,1)}},p=!1;d.on("back",(function(){v.reduce(),p=!0}));var k=function(e,t){var n=t.router,i=t.actionKey;n.beforeEach((function(e,t,n){window.setTimeout((function(){e.params[i]=p?"back":"forward",p=!1,n()}),0)})),e.util.defineReactive(n.history,"current",n.history.current,(function(){e.nextTick((function(){v.add(window.location.href)}))}))},g=!1;return{install:function(t,n){if(!n.router)return i="router",void console.warn("%cerror: ".concat(i),"color: red");var i;g||(g=!0,Object.assign(e,n),t.prototype.$routerKeepHelper=h,t.component(y.name,y),k(t,e))}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueRouterKeep=t();