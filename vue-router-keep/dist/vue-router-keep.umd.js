/*!
 * vue-router-keep.js v0.0.1
 * (c) 2019-2019 kallsave
 * Released under the MIT License.
 */
/*!
 * vue-router-keep.js v0.0.1
 * (c) 2019-2019 kallsave
 * Released under the MIT License.
 */
var t,e;t=this,e=function(){"use strict";var t="undefined"!=typeof window;function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var r=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;e(this,t),this.maxLength=n,this.init()}return i(t,[{key:"init",value:function(){this.list=[]}},{key:"_add",value:function(t){var e=this.list.indexOf(t);-1!==e&&this.list.splice(e,1),this.list.unshift(t),this.list.length>this.maxLength&&this.list.pop()}},{key:"add",value:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];this._add(e)}}},{key:"reduce",value:function(){return!!this.list.length&&this.list.shift()}},{key:"replace",value:function(t){if(!this.reduce())return!1;this._add(t)}},{key:"removeFrom",value:function(t){var e=this.list.indexOf(t);return-1!==e&&this.list.splice(e)}},{key:"remove",value:function(t){var e=this.list.indexOf(t);return-1!==e&&this.list.splice(e,1)}},{key:"removeByIndex",value:function(t){if(this.list[t])return this.list.splice(t,1)}},{key:"clearAll",value:function(){return this.list.splice(0)}},{key:"clearExclude",value:function(){for(var t=0;t<this.list.length;t++){var e=this.list[t];-1===Array.prototype.indexOf.call(arguments,e)&&(this.list.splice(t,1),t--)}}},{key:"backTo",value:function(t){var e=this.list.indexOf(t);return-1!==e&&this.list.splice(0,e)}},{key:"backToByIndex",value:function(t){return t>this.list.length-1?this.list.splice(0):this.list.splice(0,t)}},{key:"getHeader",value:function(){return this.list[0]}},{key:"getByIndex",value:function(t){return this.list[t]}},{key:"getFooter",value:function(){return this.list[this.list.length-1]}},{key:"getSize",value:function(){return this.list.length}},{key:"getStore",value:function(){return this.list}},{key:"has",value:function(t){return-1!==this.list.indexOf(t)}}]),t}(),a=new r,s=new(function(){function t(){e(this,t),this.map={}}return i(t,[{key:"on",value:function(t,e){this.map[t]?this.map[t].push(e):this.map[t]=[e]}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.map[t]&&this.map[t].forEach((function(t){t.apply(void 0,n)}))}}]),t}());window.addEventListener("hashchange",(function(){a.getByIndex(1)===window.location.href?s.emit("back"):s.emit("go")}));var o=[],c={add:function(t){},remove:function(t){},clearAll:function(t){for(var e=0;e<o.length;e++){var n=o[e],i=n.stack,r=n.cache;for(var a in n.cache)delete r[a];i.clearAll()}}};function u(t){return null!=t}var l={name:"router-keep",abstract:!0,props:{max:{type:Number,default:10,validator:function(t){return(0|t)===t}}},created:function(){this.cache=Object.create(null),this.stack=new r(this.max),o.push({cache:this.cache,stack:this.stack})},render:function(t){var e=this.$slots.default,n=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var n=t[e];if(u(n)&&(u(n.componentOptions)||(i=n).isComment&&i.asyncFactory))return n}var i}(e);if(n){var i=window.location.href;this.cache[i]?(n.componentInstance=this.cache[i].componentInstance,this.stack.add(i)):this.max>this.stack.getSize()&&(this.cache[i]=n,this.stack.add(i)),n.data.keepAlive=!0}return n||e&&e[0]},mounted:function(){this.historyStateBackHandler()},methods:{historyStateBackHandler:function(){var t=this;s.on("back",(function(){a.reduce(),t.remove(t.stack.getByIndex(0))}))},remove:function(t){var e=this.cache[t];e&&(e.componentInstance.$destroy(),this.cache[t]=null,this.stack.remove(t))}},beforeDestroy:function(){for(var t=-1,e=0;e<o.length;e++)if(o[e].cache===this.cache){t=e;break}-1!==t&&o.splice(t,1),this.cache=null,this.stack=null}},h=!1;s.on("back",(function(){h=!0}));var f=function(t,e){var n=e.router,i=e.actionKey||"actions";t.util.defineReactive(n.history,"current",n.history.current,(function(){t.nextTick((function(){a.add(window.location.href)}))})),n.beforeEach((function(t,e,n){window.setTimeout((function(){t.params[i]=h?"back":"go",h=!1,n()}),0)}))},d=!1,v={install:function(t,e){d||(d=!0,t.component(l.name,l),t.prototype.$routerKeepHelper=c,f(t,e))}};return t&&window.Vue&&window.Vue.use(v),v},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).VueRouterKeep=e();