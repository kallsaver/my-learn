<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="angular.js"></script>
		<script src="jquery-3.1.0.js"></script>
	</head>
	<body ng-app="myApp" ng-controller="myCtrl">
		<div>{{data}}</div>
	</body>
	<script>
		//'use strict';
		//a是生成的script的回调函数
		//不是angular跨域的问题,是后台设置跨域操作的问题  callback=JSON_CALLBACK不行,是因为后台没设置这个功能
		window.c = [];
		
		var url = "http://api.douban.com/v2/movie/in_theaters?callback=a";
		function a(data){
			//但是data如何在controller中使用呢?,它是异步滞后的
			console.log(data);
		}
		
		var app = angular.module('myApp',[])
		
		.run(function($rootScope,$http){
			//console.log('app',app)
			$http.jsonp(url).success(function(data){
				console.log(data)
			});
		})
		
		//利用constant和闭包实现自定义个可以注入的函数模块
		/*.constant('fn',(function(){
				window.b = function(data){
					console.log(data);
					return data;
				};
			return window.b;
		})())*/
		
		.factory('fn',function(){
			window.b = function(data){
				console.log(window.b)
			};
			return {
				getData : window.b
			}
		})
		
		
		
		
		
		.controller('myCtrl',['$scope','$http','fn',function($scope,$http,fn,$rootScope){
			console.log('fn',fn);
			
				/*setInterval(function(){
					$scope.$apply(function(){
						$scope.date = window.c
						//然后通过$digest去触发脏检查
						console.log($scope.data)
					})
				},1000)
				*/
			
			
			//$http.success函数不会触发,jquery.ajax跨域success函数一样会触发
			//一旦收到服务端的响应,callback函数立即触发
			/*jQuery.ajax({
				type:"get",
				url:"http://api.douban.com/v2/movie/in_theaters",
				async:true,
				dataType : "jsonp",
				success : function(data){
				console.log(data);
				}
			});*/
		}]);
		
		
		
	</script>
</html>
