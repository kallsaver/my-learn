<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			*{
				margin:0;
				padding:0;
			}
			.box{
				width:150px;
				height:150px;
				background:peru;
			}
		</style>
	</head>
	<body>
		<div class="box"></div>
	</body>
	<script>
		
		var obj = {
			name: 'obj',
			count: 100
		}
		
		
		function observeProperty (obj, key, val, fn) {
	      Object.defineProperty(obj, key, {
	        enumerable: true,   // 可枚举
	        configurable: true, // 可重新定义
	        get: function() {
	          return val;
	        },
	        set: function (newVal) {
	          if (val === newVal || (newVal !== newVal && val !== val)) {
	            return;
	          }
	          console.log('property更新啦 ', val, '=>', newVal);
	          val = newVal;
	          fn && fn();
	        }
	      });
	    }

        observeProperty(obj,'name',obj.name,function(obj){
            console.log('fn')
        });
        
        observeProperty(obj,'count',obj.count,function(obj){
            console.log('fn')
        });
        
        
        for(var i = 0; i < 5; i++){
        	if( i === 3){
        		obj.name = 'new name';
        	}
        	console.log('i',i);
        }
        
		// 页面首次渲染重排完毕
		requestAnimationFrame(function() {
			console.log('requestAnimationFrame');
		});
		
		setTimeout(function(){
			console.log('setTimeout');
		},0);
		
		new Promise(function(resolve, reject) {
			console.log('promise');
			resolve();
			console.log('after resolve');
		}).then(function() {
			console.log('then');
		});
		
		new Promise(function(resolve, reject) {
			console.log('promise')
			resolve();
			console.log('after resolve');
		}).then(function() {
			console.log('then1');
		});
		
		console.log('script');
		
		
	</script>
</html>
