<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<!--跨域插件-->
	<script src="http.js"></script>
	<script src="jquery-3.1.0.js"></script>
	<body>
		<div>点击我start设置为0</div>
		<div>点击我start设置为2</div>
		<div>点击我count设置为5</div>
	</body>
	<script>

		if(('onhashchange' in window) && ((typeof document.documentMode === 'undefined') || document.documentMode == 8)) {
			// 浏览器支持onhashchange事件  
			window.onhashchange = hashChangeTrigger; // TODO，对应新的hash执行的操作函数  
		} else {
			// 不支持则用定时器检测的办法  
			setInterval(function() {
				var ischanged = isHashChanged(); // TODO，检测hash值或其中某一段是否更改的函数  
				if(ischanged) {
					hashChangeTrigger(); // TODO，对应新的hash执行的操作函数  
				}
			}, 150);
		}
		
		// 路由格式 index.html#/?page=1&?category="a"
		// 这个函数会返回一个存储url参数(ajax接口)键值对对象
		function getUrlParam(){
			var result = {};
			// search是返回从问号开始后面的字符串
			// substr是切掉参数个前面的字符
			// 格式 index.html#/?page=1&category='a';会从#起计算返回page=1&category='a'
			//console.log(window.location.hash.substr(3))
			var arr = window.location.hash.substr(3).match(/[^&]+?\=[^&]+/ig).join('=').split('=');
			for(var i = 0; i < arr.length; i += 2){
				result[arr[i]] = arr[i+1];
			}
			return result;
		}
		
		window.location.hash = '#/?count=20&start=5';
		// 初始化
		hashChangeTrigger();
		// 检测到hash改变,发起ajax请求
		var urlParam = getUrlParam();
		
		function hashChangeTrigger(){

			// 每改变一次hash,都会读取一次url
			urlParam = getUrlParam();
			console.log( urlParam );
			$jsonp("http://api.douban.com/v2/movie/in_theaters?",urlParam,function(data){
				console.log(data);
				//console.log(typeof data.count)  // number
			});
		}
		//接口:http://api.douban.com/v2/movie/in_theaters?count=1&start=5

		
		var divList = document.getElementsByTagName('div');
		divList[0].onclick = function(){
			var a = {
				start : 0
			}
			
			
			// 改变url的hash
			var hash = window.location.hash;
			hash = hash.replace(/start\=\d+/,'start=0');
			window.location.hash = hash;
		}

		divList[1].onclick = function(){
			// 改变url的hash
			var hash = window.location.hash;
			hash = hash.replace(/start\=\d+/,'start=2');
			window.location.hash = hash;
		}

		
		divList[2].onclick = function(){
			// 改变url的hash
			var hash = window.location.hash;
			hash = hash.replace(/count\=\d+/,'count=5');
			window.location.hash = hash;
		}
		
		
		console.log(urlParam)
		// 对象的key和value转字符串
		function toStr(){
			for(var key in urlParam){
				
			}	
		}
		

	</script>

</html>