<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="js/angular.js"></script>
		<script>
			angular.module('myApp',[],['$provide',function($provide){
				//$provide.factory
				//$provide.service
				
				//$provide.constant
				
			}])
			
			//constant这个方法首先运行,可以用它来声明全局的常量,可以注入config,factory,service,controller任何方法中
			.constant('APIKEY','key')
			//可以声明一个函数,这个函数就可以注入了
			.constant('fn',function(){
				console.log('fn')
			})
			
			//value 不能注入config,可以注入controller,factory,service
			.value('vension','1,0,0')
			
			.config(function(APIKEY,fn){
				console.log('config',APIKEY)
				console.log('fn',fn)
			})
			
			//注入启动之后执行某些操作,这些操作需要在页面对用户可用之前执行,config之后controller之前
			//比如加载远程的模板,需要在使用前放入缓存,
			//或者在使用操作前判断用户是否登录,未登录可以先去登录页面
			.run(function($http,$rootScope){
				console.log('run执行');
			})
			
			.directive('move',function(shopFactory){
				return {
					restrict : "A",
					link : function($scope,element,attrs){
						console.log(shopFactory.fn());
						setTimeout(function(){
							console.log($scope.data[0].name);
							console.log(attrs.myAttr)
						},1000)
						
					}
				}
			})
			
			.factory('shopFactory',function(APIKEY,vension,$http){
				console.log('factory函数运行');
				var data = { product : [] }
				$http.get('data.json').success(function(_data){
					console.log(Object.prototype.toString.call(_data).slice(8,-1));
					data.product = _data;
				})
				return {
					fn : function(){
						return data;
					}
				}
			})
			
			.factory('shopArr',function(){
				console.log('factory函数运行');
				return [1,2,3]
				
			})
			
			.controller('myCtrl',[
				'$scope',
				'APIKEY',
				'vension',
				'shopFactory',
				'shopArr',
				'$rootScope',
				'$http',
				function($scope,APIKEY,version,shopFactory,shopArr,$rootScope,$http){
					$scope.aa = 1;
					console.log('controller',APIKEY);
					console.log('controller',version);
					console.log(shopArr);
					$scope.a = shopFactory.fn();
					$scope.data = [{name:'old'}];
					//console.log($scope.a.product);
					$http.get('data.json').then(function(_data){
						console.log(_data);
							$scope.data = _data.data;
						
						//angular内部的异步事件其实都已经用了脏检查,所以再用$scope.$apply会报错
						//自己自定义的异步事件,比如setInterval,jsonp跨域插件这些都是angular没有处理过的,要使用$scope.$apply
					})
					
					
			}])
		</script>
	</head>
	<body ng-app='myApp'>
		<div ng-controller='myCtrl' move my-attr='{{data[0].name}}' >{{a.product[0].name}}{{data[0].name}}</div>
	</body>
</html>
